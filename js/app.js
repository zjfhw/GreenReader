var RSSReader,currentNavJson,deviceReady,jQT,listNavJson,mainNavJson,pullDownAction,store,subscriptionData;jQT=$.jQTouch({themeSelectionSelector:"#jqt #themes ul",themeIncluded:[{title:"Default",href:"css/themes/artspot/theme.css"},{title:"jQTouch",href:"css/themes/jqt/theme.css"},{title:"Apple",href:"css/themes/apple/theme.css"}],preloadImages:["css/png/glyphicons_020_home.png","css/png/glyphicons_195_circle_info.png","css/png/glyphicons_019_cogwheel.png","css/png/glyphicons_051_eye_open.png","css/png/glyphicons_071_book.png","css/png/glyphicons_049_star.png","css/png/glyphicons_222_share.png"]});store=Lawnchair({name:"entries",record:"entry"},function(){});subscriptionData=Lawnchair({name:"subscript",record:"entry"},function(){});RSSReader=Em.Application.create({ready:function(){this._super();RSSReader.getSubscription();return RSSReader.navbarController.set("currentPage",mainNavJson)}});mainNavJson=[{url:"#main-view",title:"Home",icon:"css/png/glyphicons_020_home.png"},{url:"#about-view",title:"About",icon:"css/png/glyphicons_195_circle_info.png"},{url:"#settings-view",title:"Setting",icon:"css/png/glyphicons_019_cogwheel.png"}];listNavJson=[{url:"#",title:"Unread",icon:"css/png/glyphicons_051_eye_open.png",countName:"unreadCount",action:"showUnread"},{url:"#",title:"All",icon:"css/png/glyphicons_071_book.png",countName:"itemCount",action:"showAll"},{url:"#",title:"Starred",icon:"css/png/glyphicons_049_star.png",countName:"starredCount",action:"showStarred"},{url:"#",title:"Read",icon:"css/png/glyphicons_087_log_book.png",countName:"readCount",action:"showRead"}];currentNavJson=[{url:"#",title:"Mark as Unread",icon:"css/png/glyphicons_052_eye_close.png",action:"toggleUnread"},{url:"#",title:"Star",icon:"css/png/glyphicons_049_star.png",action:"toggleStar"},{url:"#",title:"Read in Browser",icon:"css/png/glyphicons_222_share.png",action:"inBrowser"}];RSSReader.FindFeed=function(a){showLoader();if(a&&a.substring(0,6).toLowerCase()==="q=http"){return $.getJSON("https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&"+a+"&callback=?",function(c){var b;hideLoader();try{b={};b.url=c.responseData.feed.feedUrl;b.title=c.responseData.feed.title;if(RSSReader.subscriptionController.addItem(b)){b.key=b.url;subscriptionData.save(b)}return jQT.goTo("#main-view","flipright")}catch(d){return alert("wrong url")}})}else{return $.getJSON("https://ajax.googleapis.com/ajax/services/feed/find?v=1.0&"+a+"&callback=?",function(b){console.log("query",b,b.responseData.entries);RSSReader.queryResultController.addItem(b.responseData.entries);return hideLoader()})}};RSSReader.GetItemsFromStore=function(c,b,d){var a;showLoader();store=Lawnchair({name:c,record:"entry"},function(){});a=store.all(function(e){e.forEach(function(g){var f;f=RSSReader.Item.create(g);return RSSReader.dataController.addItem(f)});return console.log("entries load form local:",e.length)});if(!c){alert("no url");hideLoader()}return $.getJSON("https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&q="+c+"&callback=?",function(f){var e;console.log(f.responseData);if(!f.responseData||!f.responseData.feed){alert("check your url");hideLoader()}a=f.responseData.feed.entries;e=f.responseData.feed.feedUrl;a.map(function(h){var g;g={};g.item_id=h.link;g.pub_name=f.responseData.feed.title;g.pub_author=h.author;g.title=h.title;g.feed_link=e;g.content=h.content;g.item_link=h.link;g.short_desc=h.contentSnippet;g.pub_date=new Date(h.publishedDate);g.read=false;g.key=g.item_id;if(RSSReader.dataController.addItem(RSSReader.Item.create(g))){return store.save(g)}});if(!b){b="showDefault"}RSSReader.itemController[b]();hideLoader();if(d){return d()}})};RSSReader.clearStore=function(){subscriptionData.all(function(a){return a.forEach(function(b){console.log(b.key);return Lawnchair({name:b.key,record:"entry"},function(){return this.nuke()})})});return RSSReader.dataController.content.clear()};RSSReader.getSubscription=function(){return subscriptionData.all(function(a){a.forEach(function(c){var b;b=RSSReader.Subscription.create(c);return RSSReader.subscriptionController.addItem(b)});return console.log("subscription load form local:",a.length,a)})};deviceReady=function(){var b,a;if(window.device){console.log("phonegap ready")}else{$(".swipe").swipe(function(c,e){var d;console.log("swipe",e.direction);if(e.direction==="right"){RSSReader.itemNavController.prev()}else{if(e.direction==="left"){RSSReader.itemNavController.next()}}d=$(this).iscroll();d.refresh();return d.scrollTo(0,0)});$(".swipeToDelete").swipe(function(c,e){var f,d;d=!e?"":e;console.log("swipe",d.direction);f=$(this);if(d.direction==="right"){console.log(f.next());f.addClass("delete");return f.next().removeClass("hide")}else{if(d.direction==="left"){f.removeClass("delete");return f.next().addClass("hide")}}})}$("#search-news").live("submit",function(){console.log("search news",$(this).serialize());return RSSReader.FindFeed($(this).serialize())});a=RSSReader.get("listView");if(!a){console.log("list not created");a=RSSReader.ListView.create();RSSReader.set("listView",a);a.appendTo($("#jqt"))}b=RSSReader.get("currentView");if(!b){console.log("current not created");b=RSSReader.CurrentView.create();RSSReader.set("currentView",b);b.appendTo($("#jqt"))}$("#list-view").live("pageAnimationEnd",function(c,d){if(d.direction==="in"){return RSSReader.navbarController.set("currentPage",listNavJson)}});$("#main-view").live("pageAnimationEnd",function(c,d){if(d.direction==="in"){return RSSReader.navbarController.set("currentPage",mainNavJson)}});return $("#current-view").live("pageAnimationEnd",function(c,d){if(d.direction==="in"){return RSSReader.navbarController.set("currentPage",currentNavJson)}})};if(navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry)/)){console.log("prepair device");document.addEventListener("deviceready",deviceReady,false)}else{$(deviceReady)}pullDownAction=function(a){return RSSReader.itemController.refreshList(function(){return a.refresh()})};RSSReader.pullinit=function(){var a,b;a=$("#pullDown");b=51;return $(".pullable").iscroll({topOffset:b,onRefresh:function(){if(a.hasClass("loading")){console.log("remove");a.removeClass();return a.find("pullDownLabel").html("PullDown to Refresh")}},onScrollMove:function(){if(this.y>5&&!a.hasClass("flip")){a.addClass("flip");a.find(".pullDownLabel").html("Release to Refresh");return this.minScrollY=0}else{if(this.y<5&&a.hasClass("flip")){a.removeClass("flip");a.find(".pullDownLabel").html("Pull down to refresh");return this.minScrollY=-b}}},onScrollEnd:function(){if(a.hasClass("flip")){a.addClass("loading");a.find(".pullDownLabel").html("Loading...");return pullDownAction(this)}}})};RSSReader.dataController=Em.ArrayController.create({content:[],addItem:function(d){var c,a,b;c=this.filterProperty("item_id",d.item_id).length;if(c===0){b=this.get("length");a=this.binarySearch(Date.parse(d.get("pub_date")),0,b);this.insertAt(a,d);return true}else{return false}},binarySearch:function(e,a,d){var b,c;if(a===d){return a}b=a+Math.floor((d-a)/2);c=Date.parse(this.objectAt(b).get("pub_date"));if(e<c){return this.binarySearch(e,b+1,d)}else{if(e>c){return this.binarySearch(e,a,b)}}return b},itemCount:(function(){return this.get("length")}).property("@each"),readCount:(function(){return this.filterProperty("read",true).get("length")}).property("@each.read"),unreadCount:(function(){return this.filterProperty("read",false).get("length")}).property("@each.read"),starredCount:(function(){return this.filterProperty("starred",true).get("length")}).property("@each.starred")});RSSReader.itemController=Em.ArrayController.create({content:[],currentList:"showDefault",refreshList:function(a){return RSSReader.GetItemsFromStore(RSSReader.subscriptionController.get("currentSubscription").url,this.get("currentList"),a)},filterBy:function(a,b){return this.set("content",RSSReader.dataController.filterProperty(a,b))},clearFilter:function(){return this.set("content",RSSReader.dataController.get("content"))},showDefault:function(){this.filterBy("read",false);return this.set("currentList","showUnread")},showAll:function(){this.clearFilter();return this.set("currentList","showAll")},showRead:function(){this.filterBy("read",true);return this.set("currentList","showRead")},showStarred:function(){this.filterBy("starred",true);return this.set("currentList","showStarred")},showUnread:function(){this.filterBy("read",false);return this.set("currentList","showUnread")},markAllRead:function(){this.forEach(function(a){return a.set("read",true)});return RSSReader.navbarController.changeTab()},itemCount:(function(){return this.get("length")}).property("@each"),readCount:(function(){return this.filterProperty("read",true).get("length")}).property("@each.read"),unreadCount:(function(){return this.filterProperty("read",false).get("length")}).property("@each.read"),starredCount:(function(){return this.filterProperty("starred",true).get("length")}).property("@each.starred")});RSSReader.itemNavController=Em.Object.create({currentItem:null,hasPrev:false,hasNext:false,select:function(b){var a;if(b){this.set("currentItem",b);this.toggleRead(true);a=RSSReader.itemController.content.indexOf(this.get("currentItem"));this.set("hasNext",a+1<RSSReader.itemController.get("itemCount"));return this.set("hasPrev",a!==0)}else{this.set("hasPrev",false);return this.set("hasNext",false)}},toggleRead:function(b){var a;if(b===void 0){b=!this.currentItem.get("read")}this.currentItem.set("read",b);if(this.currentItem.get("read")===false){a=this.currentItem.get("item_id");return store.get(a,function(c){c.read=b;return store.save(c)})}},toggleUnread:function(){return this.toggleRead(false)},toggleStar:function(b){var a;if(b===void 0){b=!this.currentItem.get("starred")}this.currentItem.set("starred",b);a=this.currentItem.get("item_id");return store.get(a,function(c){c.starred=b;return store.save(c)})},next:function(){var b,a;b=RSSReader.itemController.content.indexOf(this.get("currentItem"));a=RSSReader.itemController.content[b+1];if(a){return this.select(a)}},prev:function(){var b,a;b=RSSReader.itemController.content.indexOf(this.get("currentItem"));a=RSSReader.itemController.content[b-1];if(a){return this.select(a)}}});RSSReader.navbarController=Em.ArrayController.create({content:[],itemCountBinding:"RSSReader.dataController.itemCount",currentPage:listNavJson,changeTab:function(){var c,e,b,d,a;this.clear();d=this.get("currentPage");a=[];for(e=0,b=d.length;e<b;e++){c=d[e];a.push(this.pushObject(RSSReader.NavButton.create(c)))}return a},pageChange:(function(){this.changeTab();return jQT.initTabbar()}).observes("currentPage"),itemCountChange:(function(){this.changeTab();return jQT.initTabbar()}).observes("itemCount")});RSSReader.queryResultController=Em.ArrayController.create({content:[],addItem:function(a){var b;this.clear();b=this;return a.map(function(c){return b.pushObject(RSSReader.QueryResult.create(c))})}});RSSReader.subscriptionController=Em.ArrayController.create({content:[],currentSubscription:null,addItem:function(c){var b,a;a={};a.url=c.url;a.title=c.title;b=this.filterProperty("url",c.url).length;if(b===0){a.key=c.url;this.insertAt(0,RSSReader.Subscription.create(a));return true}else{return false}},removeItem:function(a){var b;console.log("deleting",a);b=this.filterProperty("url",a);if(b[0]){console.log(b,this.get("content").length,this.get("content").indexOf(b[0],this.get("content")));this.get("content").removeAt(this.indexOf(b[0]))}Lawnchair({name:a,record:"entry"},function(){return this.nuke()});return subscriptionData.remove(a,function(){return this.all("console.log(subscript.length)")})}});RSSReader.Item=Em.Object.extend({read:false,starred:false,item_id:null,title:null,short_desc:null,content:null,pub_name:null,pub_author:null,pub_date:null,feed_link:null,item_link:null});RSSReader.NavButton=Em.Object.extend({currentListBinding:"RSSReader.itemController.currentList",itemCountBinding:"RSSReader.dataController.itemCount",unreadCountBinding:"RSSReader.dataController.unreadCount",starredCountBinding:"RSSReader.dataController.starredCount",readCountBinding:"RSSReader.dataController.readCount",url:null,title:null,icon:null,currentItemBinding:"RSSReader.itemNavController.currentItem",countName:null,count:(function(){return this.get(this.get("countName"))}).property("countName"),enabled:(function(){if(this.get("currentItem")){return(this.get("currentItem").starred===true&&this.get("action")==="toggleStar")||this.get("currentList")===this.get("action")}return this.get("currentList")===this.get("action")}).property("currentList"),action:null});RSSReader.QueryResult=Em.Object.extend({contentSnippet:null,link:null,title:null,url:null});RSSReader.Subscription=Em.Object.extend({url:null,title:null,icon:null});RSSReader.ListView=Em.View.extend({templateName:"listview",elementId:"list-view",didInsertElement:function(){return Em.run.next(function(){return jQT.initbars()})}});RSSReader.CurrentView=Em.View.extend({templateName:"current",elementId:"current-view"});RSSReader.SubscriptionView=Em.CollectionView.extend({contentBinding:"RSSReader.subscriptionController.content",tagName:"ul",classNames:["plastic","view"],itemViewClass:Em.View.extend({swipeOptions:{direction:Em.OneGestureDirection.Left|Em.OneGestureDirection.Right,cancelPeriod:100,swipeThreshold:10},swipeEnd:function(a){var b;b=this.$();if(Em.OneGestureDirection.Right===a.swipeDirection){console.log("swipe left");b.find("a").addClass("delete");return b.find("small").removeClass("hide")}else{if(Em.OneGestureDirection.Left===a.swipeDirection){console.log("swipt right");b.find("a").removeClass("delete");return b.find("small").addClass("hide")}}},tagName:"li",classNames:["arrow"],getstore:function(){console.log("getstroe",this.get("content").url);RSSReader.GetItemsFromStore(this.get("content").url);RSSReader.subscriptionController.set("currentSubscription",this.get("content"));console.log("click",this.get("content").url);return jQT.goTo("#list-view","slideleft")},"delete":function(){return RSSReader.subscriptionController.removeItem(this.get("content").url)}}),emptyView:Ember.View.extend({template:Ember.Handlebars.compile("Your subscription is empty")}),contentLengthDidChange:(function(){console.log("subscription changed",this.get("content"));return Em.run.next(function(){return jQT.setPageHeight()})}).observes("content.length")});RSSReader.QueryResultView=Em.CollectionView.extend({contentBinding:"RSSReader.queryResultController.content",tagName:"ul",classNames:["plastic"],itemViewClass:Em.View.extend({tagName:"li",click:function(){var a;a={};a.url=this.get("content").url;a.title=this.get("content").title;if(RSSReader.subscriptionController.addItem(a)){a.key=a.url;subscriptionData.save(a)}return jQT.goBack()}}),contentLengthDidChange:(function(){return Em.run.next(function(){return jQT.setPageHeight()})}).observes("content.length")});RSSReader.FooterNavBarView=Em.CollectionView.extend({contentBinding:"RSSReader.navbarController.content",tagName:"ul",itemViewClass:Em.View.extend({tagName:"li",didInsertElement:function(){return Em.run.once(function(){return jQT.initTabbar()})},click:function(){var a;a=this.get("content");if(this.get("content").get("action")==="inBrowser"){window.location=RSSReader.itemNavController.get("currentItem").item_link;return}if(RSSReader.itemController[this.get("content").get("action")]){return RSSReader.itemController[this.get("content").get("action")]()}else{if(RSSReader.itemNavController[this.get("content").get("action")]){return RSSReader.itemNavController[this.get("content").get("action")]()}}}})});RSSReader.SummaryListView=Em.CollectionView.extend({classNames:["plastic","view"],tagName:"ul",itemViewClass:Em.View.extend({classNameBindings:["read","starred"],read:(function(){var a;return a=this.get("content").get("read")}).property("RSSReader.itemController.@each.read"),starred:(function(){var a;return a=this.get("content").get("starred")}).property("RSSReader.itemController.@each.starred"),click:function(a){var b;b=this.get("content");RSSReader.itemNavController.select(b);return jQT.goTo("#current-view","slideleft")},dateFromNow:(function(){return moment(this.get("content").get("pub_date")).fromNow()}).property("RSSReader.itemController.@each.pub_date"),viewDidChange:(function(){return jQT.setPageHeight()}).observes("content")}),contentLengthDidChange:(function(){var a;a=this;return Em.run.next(function(){return jQT.setPageHeight()})}).observes("content.length"),contentBinding:"RSSReader.itemController.content",didInsertElement:function(){return Em.run.next(function(){return RSSReader.pullinit()})}});RSSReader.EntryItemView=Em.View.extend({contentBinding:"RSSReader.itemNavController.currentItem",dateFromNow:(function(){return moment(this.get("content").get("pub_date")).fromNow()}).property("content.pub_date"),viewDidChange:(function(){return Em.run.once(function(){return jQT.setPageHeight()})}).observes("content"),swipeOptions:{direction:Em.OneGestureDirection.Left|Em.OneGestureDirection.Right,cancelPeriod:100,swipeThreshold:10},swipeEnd:function(a){var b;if(Em.OneGestureDirection.Right===a.swipeDirection){RSSReader.itemNavController.prev()}else{if(Em.OneGestureDirection.Left===a.swipeDirection){RSSReader.itemNavController.next()}}b=$(".swipe").iscroll();b.refresh();return b.scrollTo(0,0)}});